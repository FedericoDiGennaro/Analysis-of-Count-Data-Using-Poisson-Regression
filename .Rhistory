axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10) )
hist(y$Apprentices)
mean(y$Apprentices)
var(y$Apprentices)
par(mfrow=c(1,1))
boxplot(X[-4], las = 2, col = c("red", "steelblue", "yellow"), ylab ="(%)")
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = poisson(link = "log"))
summary(poisson.model)
poisson.model2<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = quasipoisson())
summary(poisson.model2)
cov.m1 <- vcovHC(poisson.model, type="HC0")
std.err <- sqrt(diag(cov.m1))
r.est <- cbind(Estimate= coef(poisson.model), "Robust SE" = std.err,
"Pr(>|z|)" = 2 * pnorm(abs(coef(poisson.model)/std.err), lower.tail=FALSE),
LL = coef(poisson.model) - 1.96 * std.err,
UL = coef(poisson.model) + 1.96 * std.err)
r.est
with(poisson.model, cbind(res.deviance = deviance, df = df.residual,
p = pchisq(deviance, df.residual, lower.tail=FALSE)))
epiDisplay::poisgof(poisson.model)
hist(y$Apprentices)
hist(y$Apprentices, breaks=10)
hist(y$Apprentices, breaks=siq(0:250,10))
hist(y$Apprentices, breaks=seq(0:250,10))
hist(y$Apprentices, breaks=seq(0,250,10))
mean(y$Apprentices)
var(y$Apprentices)
View(y)
install.packages("xtable")
help(xtable)
View(X)
View(y)
data <- read_excel("data/data.xlsx", skip = 1)
# load data ---------------------------------------------------------------
rm(list = ls())
# load packages -----------------------------------------------------------
library(ggplot2)
library(tidyverse)
library(GGally)
library(readxl)
library(MASS) # for BOXCOX
library(car) # for VIF
library(performance) # for nicer multicollinearity plot
library(jtools)
library(sandwich)
library(goodness-of-fit)
library(pscl)
# load data ---------------------------------------------------------------
rm(list = ls())
data <- read_excel("data/data.xlsx", skip = 1)
glimpse(data)
# define regressors
X <- data[-c(1,3)]
X$Direction <- as.factor(X$Direction)
# define dependent
y <- data[3]
View(y)
View(y)
hist(y$Apprentices, breaks=seq(0,250,10))
View(y)
View(X)
data <- read_excel("data/data2.xlsx")
glimpse(data)
# define regressors
X <- data[-c(1,3)]
X$Direction <- as.factor(X$Direction)
# define dependent
y <- data[3]
hist(y$Apprentices, breaks=seq(0,250,10))
mean(y$Apprentices)
var(y$Apprentices)
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = poisson(link = "log"))
summary(poisson.model)
poisson.model2<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = quasipoisson())
summary(poisson.model2)
rm(list = ls())
data("polyps", package = "HSAUR3")
force(polyps)
View(polyps)
mean(polyps$number)
var(polyps$number)
polyps.glm.1 <- glm(number ~ treat + age, data = polyps, family = poisson())
summary(polyps.glm.1)
with(polyps.glm.1, cbind(res.deviance = deviance, df = df.residual,
p = pchisq(deviance, df.residual, lower.tail=FALSE)))
with(poisson.model, cbind(res.deviance = deviance, df = df.residual,
p = pchisq(deviance, df.residual, lower.tail=FALSE)))
#MODEL 2 removing the outlier
rm(list = ls())
data <- read_excel("data/data2.xlsx")
glimpse(data)
# define regressors
X <- data[-c(1,3)]
X$Direction <- as.factor(X$Direction)
# define dependent
y <- data[3]
hist(y$Apprentices, breaks=seq(0,250,10))
mean(y$Apprentices)
var(y$Apprentices)
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = poisson(link = "log"))
summary(poisson.model)
with(poisson.model, cbind(res.deviance = deviance, df = df.residual,
p = pchisq(deviance, df.residual, lower.tail=FALSE)))
poisson.model2<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = quasipoisson())
summary(poisson.model2)
poisson.model3<-glm(Apprentices ~ (Distance + Population + Degree_Urb
+ Direction)^2 , data, family = quasipoisson())
summary(poisson.model3)
with(poisson.model3, cbind(res.deviance = deviance, df = df.residual,
p = pchisq(deviance, df.residual, lower.tail=FALSE)))
final_model <- step(poisson.model3, direction = "backward", trace = FALSE)
#stepwise selection
# Perform stepwise model selection using AIC
model_stepwise <- stepAIC(poisson.model3, direction = "both")
summary(poisson.model3)
summary(poisson.model2)
summary(poisson.model)
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = poisson(link = "log"),
control = glm.control(maxit = 1000)) )
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = poisson(link = "log"),
control = glm.control(maxit = 1000))
summary(poisson.model)
poisson.model2<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = quasipoisson(),
control = glm.control(maxit = 1000))
summary(poisson.model2)
rm(list = ls())
data("polyps", package = "HSAUR3")
mean(polyps$number)
var(polyps$number)
polyps.glm.1 <- glm(number ~ treat + age, data = polyps, family = poisson())
summary(polyps.glm.1)
polyps.glm.2 <- glm(number ~ treat + age, data = polyps, family = quasipoisson())
summary(polyps.glm.2)
# load packages -----------------------------------------------------------
library(ggplot2)
library(tidyverse)
library(GGally)
library(readxl)
library(MASS) # for BOXCOX
library(car) # for VIF
library(performance) # for nicer multicollinearity plot
library(jtools)
library(sandwich)
library(goodness-of-fit)
library(pscl)
# load data ---------------------------------------------------------------
rm(list = ls())
data <- read_excel("data/data.xlsx")
glimpse(data)
# define regressors
X <- data[-c(1,3)]
X$Direction <- as.factor(X$Direction)
# define dependent
y <- data[3]
# check presence of missing values
print(c('is there any missing value? ', any(is.na(data))))
# univariate numerical analysis for numeric variables
summary(X)
var(X[-4])
ggpairs(X)
# MODEL 3: logaritmic transform
X$Distance = log(X$Distance)
X$Population = log(X$Population)
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = poisson(link = "log"),
control = glm.control(maxit = 1000))
summary(poisson.model)
ggpairs(X)
#MODEL 2 removing the outlier
rm(list = ls())
data <- read_excel("data/data2.xlsx")
glimpse(data)
# define regressors
X <- data[-c(1,3)]
X$Direction <- as.factor(X$Direction)
# define dependent
y <- data[3]
hist(y$Apprentices, breaks=seq(0,250,10))
mean(y$Apprentices)
var(y$Apprentices)
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = poisson(link = "log"),
control = glm.control(maxit = 1000))
summary(poisson.model)
# MODEL 3: logaritmic transform
X$Distance = log(X$Distance)
X$Population = log(X$Population)
ggpairs(X)
# MODEL 3: logaritmic transform
data$Distance = log(data$Distance)
data$Population = log(data$Population)
# define regressors
data$Direction <- as.factor(data$Direction)
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction, data , family = poisson(link = "log"),
control = glm.control(maxit = 1000))
summary(poisson.model)
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction, data , family = quasipoisson(),
control = glm.control(maxit = 1000))
summary(poisson.model)
# MODEL 4: interactions ---------------------------------------------------------------------
ggpairs(X)
poisson.model3<-glm(Apprentices ~ (Distance + Population + Degree_Urb
+ Direction)^2 , data, family = poisson(link="log"))
summary(poisson.model3)
#without the log
rm(list = ls())
data <- read_excel("data/data2.xlsx")
glimpse(data)
data$Direction <- as.factor(data$Direction)
X <- data[-c(1,3)]
y <- data[3]
poisson.model3<-glm(Apprentices ~ (Distance + Population + Degree_Urb
+ Direction)^2 , data, family = poisson(link="log"))
summary(poisson.model3)
poisson.model3<-glm(Apprentices ~ (Distance + Population + Degree_Urb
+ Direction)^2 , data, family = quasipoisson())
summary(poisson.model3)
#with the log
rm(list = ls())
data <- read_excel("data/data2.xlsx")
glimpse(data)
data$Direction <- as.factor(data$Direction)
X <- data[-c(1,3)]
y <- data[3]
data$Distance = log(data$Distance)
data$Population = log(data$Population)
poisson.model3<-glm(Apprentices ~ (Distance + Population + Degree_Urb
+ Direction)^2 , data, family = poisson(link="log"))
summary(poisson.model3)
poisson.model3<-glm(Apprentices ~ (Distance + Population + Degree_Urb
+ Direction)^2 , data, family = quasipoisson())
summary(poisson.model3)
# load data ---------------------------------------------------------------
rm(list = ls())
# load packages -----------------------------------------------------------
library(ggplot2)
library(tidyverse)
library(GGally)
library(readxl)
library(MASS) # for BOXCOX
library(car) # for VIF
library(performance) # for nicer multicollinearity plot
library(jtools)
library(sandwich)
library(goodness-of-fit)
library(pscl)
# load data ---------------------------------------------------------------
rm(list = ls())
data <- read_excel("data/data.xlsx")
glimpse(data)
# define regressors
data$Direction <- as.factor(data$Direction)
X <- data[-c(1,3)]
# define dependent
y <- data[3]
# check presence of missing values
print(c('is there any missing value? ', any(is.na(data))))
# univariate numerical analysis for numeric variables
summary(X)
var(X[-4])
ggpairs(X)
# in order to check the differences in distribution due to difference in the
# union_shop variable, use this: (DISAGGREGATE DATA wrt Union_shop)
ggpairs(X[],
aes(color = X$Direction, alpha = .5),
lower = list(continuous = 'smooth'), legend = 1) +
theme(legend.position = "bottom", text = element_text(size = 10),
axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10) )
# in order to check the differences in distribution due to difference in the
# union_shop variable, use this: (DISAGGREGATE DATA wrt Union_shop)
ggpairs(X[],
aes(color = X$Direction, alpha = .5),
lower = list(continuous = 'smooth'), legend = 1) +
theme(legend.position = "bottom", text = element_text(size = 12),
axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8) )
# in order to check the differences in distribution due to difference in the
# union_shop variable, use this: (DISAGGREGATE DATA wrt Union_shop)
ggpairs(X[],
aes(color = X$Direction, alpha = .5),
lower = list(continuous = 'smooth'), legend = 1) +
theme(legend.position = "bottom", text = element_text(size = 12),
axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8))+
labs(color = "Custom Legend Label")
# in order to check the differences in distribution due to difference in the
# union_shop variable, use this: (DISAGGREGATE DATA wrt Union_shop)
# Create the ggpairs plot
plot <- ggpairs(X, aes(color = Direction, alpha = .5),
lower = list(continuous = 'smooth'), legend = 1) +
theme(legend.position = "bottom", text = element_text(size = 12),
axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8))
# Customize the legend labels
plot <- plot +
scale_color_manual(values = c("Up" = "blue", "Down" = "red"),
labels = c("Direction"))
# Remove alpha from the legend
plot <- plot +
scale_alpha_identity(guide = "none")
# Display the plot
print(plot)
# in order to check the differences in distribution due to difference in the
# union_shop variable, use this: (DISAGGREGATE DATA wrt Union_shop)
# Create the ggpairs plot
plot <- ggpairs(X, aes(color = X$Direction, alpha = .5),
lower = list(continuous = 'smooth'), legend = 1) +
theme(legend.position = "bottom", text = element_text(size = 12),
axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8))
# Customize the legend labels
plot <- plot +
scale_color_manual(values = c("Up" = "blue", "Down" = "red"),
labels = c("Direction"))
# Remove alpha from the legend
plot <- plot +
scale_alpha_identity(guide = "none")
# Display the plot
print(plot)
# in order to check the differences in distribution due to difference in the
# union_shop variable, use this: (DISAGGREGATE DATA wrt Union_shop)
# Create the ggpairs plot
plot <- ggpairs(X, aes(color = Direction, alpha = .5),
lower = list(continuous = 'smooth'), legend = 1) +
theme(legend.position = "bottom", text = element_text(size = 12),
axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8))
# Customize the legend labels and colors
plot <- plot +
scale_color_manual(values = c("Up" = "blue", "Down" = "red", "Sideways" = "green"),
labels = c("Direction"))
# Remove alpha from the legend
plot <- plot +
scale_alpha_identity(guide = "none")
# Display the plot
print(plot)
# in order to check the differences in distribution due to difference in the
# union_shop variable, use this: (DISAGGREGATE DATA wrt Union_shop)
# Create the ggpairs plot
plot <- ggpairs(X, aes(color = Direction, alpha = .5),
lower = list(continuous = 'smooth'), legend = 1) +
theme(legend.position = "bottom", text = element_text(size = 12),
axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8))
# Remove alpha from the legend
plot <- plot +
scale_alpha_identity(guide = "none")
# Display the plot
print(plot)
# Create the ggpairs plot with histogram
plot <- ggpairs(data, lower = list(continuous = 'smooth'), legend = 1) +
theme(legend.position = "bottom", text = element_text(size = 12),
axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8))
# Create the ggpairs plot with histogram
plot <- ggpairs(data[3,6], lower = list(continuous = 'smooth'), legend = 1) +
theme(legend.position = "bottom", text = element_text(size = 12),
axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8))
# Add histograms based on the color of Direction
plot <- plot +
geom_histogram(aes(x = X, fill = Direction), alpha = 0.5, position = "identity")
# Display the plot
print(plot)
# Add histograms based on the color of Direction
plot <- plot +
geom_bar(aes(x = X, fill = Direction), alpha = 0.5, position = "identity")
# Display the plot
print(plot)
# Create the ggpairs plot with histogram
hist(y$Apprentices, breaks=seq(0,250,10))
hist(data, breaks=seq(0,250,10), col = "blue", main = "Histogram", xlab = "Value", ylab = "Frequency")
hist(y$Apprentices, breaks=seq(0,250,10), col = "blue", main = "Histogram", xlab = "Value", ylab = "Frequency")
# Setup options for R Markdown
library(ggplot2)
library(tidyverse)
library(GGally)
library(readxl)
library(MASS) # for BOXCOX
library(car) # for VIF
library(performance) # for nicer multicollinearity plot
library(xtable)
data <- read_excel("data/data.xlsx")
knitr::opts_chunk$set(
echo       = FALSE,    # Do not print code
warning    = FALSE,    # Suppress warnings
message    = FALSE,    # Suppress messages
fig.align  = "center", # Center figures
fig.width  = 2.7,      # Good standard figure width for single-panel figures
fig.height = 2.4,       # Good standard figure height for single-panel figures
fig.pos = "ht",
out.extra = ""
)
# define regressors
data$Direction <- as.factor(data$Direction)
X <- data[-c(1,3)]
# in order to check the differences in distribution due to difference in the
# union_shop variable, use this: (DISAGGREGATE DATA wrt Direction)
plot <- ggpairs(X, aes(color = Direction, alpha = .5),
lower = list(continuous = 'smooth'),
upper = list(continuous = wrap("cor",size = 12)),
legend = 1, textsize=25) +
theme(legend.position = "bottom", text = element_text(size = 25),
axis.text.x = element_text(size = 20), axis.text.y = element_text(size = 20))
# Remove alpha from the legend
plot <- plot +
scale_alpha_identity(guide = "none")
# Display the plot
print(plot)
# define dependent
y <- data[3]
hist(y$Apprentices, breaks=seq(0,250,10), main="Histogram of the outcome variable", xlab = "Number of Apprentices", ylab = "Frequency")
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = poisson(link = "log"))
summary(poisson.model)
d <- summary(poisson.model)$coefficients
View(d)
formatted_d <- format(d, digits = c(2, 2, 2, 2, 2), scientific = c(FALSE, FALSE, FALSE, FALSE, TRUE))
# Format the coefficient table
formatted_d <- d
formatted_d[, 5] <- formatC(formatted_d[, 5], digits = 2, format = "fg")
formatted_d[, 4] <- formatC(formatted_d[, 4], digits = 2, format = "fg")
# Create the kable table
kable(formatted_d)
# Create the kable table
knitr::kable(formatted_d)
# load data ---------------------------------------------------------------
rm(list = ls())
data <- read_excel("data/data.xlsx")
glimpse(data)
# define regressors
data$Direction <- as.factor(data$Direction)
X <- data[-c(1,3)]
# define dependent
y <- data[3]
# check presence of missing values
print(c('is there any missing value? ', any(is.na(data))))
# univariate numerical analysis for numeric variables
summary(X)
var(X[-4])
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = poisson(link = "log"))
summary(poisson.model)
qpoisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = quasipoisson())
summary(qpoisson.model)
# MODEL 2: removing the outlier ---------------------------------------------------------------------
rm(list = ls())
data <- read_excel("data/data2.xlsx")
glimpse(data)
# define regressors
data$Direction <- as.factor(data$Direction)
X <- data[-c(1,3)]
# define dependent
y <- data[3]
hist(y$Apprentices, breaks=seq(0,250,10))
mean(y$Apprentices)
var(y$Apprentices)
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = poisson(link = "log"),
control = glm.control(maxit = 1000))
summary(poisson.model)
qpoisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction , data, family = quasipoisson(),
control = glm.control(maxit = 1000))
summary(qpoisson.model)
# MODEL 3: log of population and distance ---------------------------------------------------------------------
data$Distance = log(data$Distance)
data$Population = log(data$Population)
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction, data , family = poisson(link = "log"),
control = glm.control(maxit = 1000))
summary(poisson.model)
poisson.model<-glm(Apprentices ~ Distance + Population + Degree_Urb
+ Direction, data , family = quasipoisson(),
control = glm.control(maxit = 1000))
summary(poisson.model)
# MODEL 4: interactions ---------------------------------------------------------------------
ggpairs(X)
#without the log
rm(list = ls())
data <- read_excel("data/data2.xlsx")
glimpse(data)
data$Direction <- as.factor(data$Direction)
X <- data[-c(1,3)]
y <- data[3]
poisson.model3<-glm(Apprentices ~ (Distance + Population + Degree_Urb
+ Direction)^2 , data, family = poisson(link="log"))
summary(poisson.model3)
poisson.model3<-glm(Apprentices ~ (Distance + Population + Degree_Urb
+ Direction)^2 , data, family = quasipoisson())
summary(poisson.model3)
#with the log
rm(list = ls())
data <- read_excel("data/data2.xlsx")
glimpse(data)
data$Direction <- as.factor(data$Direction)
X <- data[-c(1,3)]
y <- data[3]
data$Distance = log(data$Distance)
data$Population = log(data$Population)
poisson.model3<-glm(Apprentices ~ (Distance + Population + Degree_Urb
+ Direction)^2 , data, family = poisson(link="log"))
summary(poisson.model3)
poisson.model3<-glm(Apprentices ~ (Distance + Population + Degree_Urb
+ Direction)^2 , data, family = quasipoisson())
summary(poisson.model3)
with(poisson.model3, cbind(res.deviance = deviance, df = df.residual,
p = pchisq(deviance, df.residual, lower.tail=FALSE)))
